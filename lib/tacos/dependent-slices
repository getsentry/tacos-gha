#!/bin/bash
set -euo pipefail
HERE="$(dirname "$(readlink -f "$0")")"
TACOS_GHA_HOME="$(cd "$HERE"/../..; pwd)"
export PYTHONPATH="$TACOS_GHA_HOME${PYTHONPATH+:$PYTHONPATH}"

SHA1="${1:-HEAD^}"
SHA2="${2:-HEAD}"

set -x

python -m lib.tacos.dependent_slices <(
    git diff  "$SHA1" "$SHA2" \
        --name-only \
        --diff-filter=ACMRT \
  ) |
  # transform newline-delimited list into json:
  jq -R | jq -s \
;
