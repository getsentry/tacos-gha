#!/usr/bin/env -S sed -zrf
# Allow for arbitrary characters to be passed through gha artifact names, via
# an escaping scheme. This means we can use user inputs as part of our artifact
# names while still writing no code whatsoever to handle weird user inputs
# breaking the system.
#
# All escapes start with `$` (`$` is escaped as `$$`), with one special case:
# `/` is escaped to ` `, allowing escaped file paths to be quite readable. (` `
# is escaped to `$ `.)

# reference:
# actions/upload-artifact notes: Invalid characters include: ":<>|*?\r\n\/
# in other words, valid characters include: ' `~!@#$%^&()_+{}-=[];,.
# unused escapes: ~@#`'()-=[]

# self-escape a couple characters (& and ;) so we can use them:
s \x00 \&#0\x00 g  # null is a tmp placeholder for semicolon
s & \&amp\x00 g
s ; \&semi\x00 g
s \x00 ; g  # resolve tmp placeholders

s \" \&quot; g
s \: \&colon; g
 s < \&lt; g
 s > \&gt; g
s \| \&VerticalLine; g
s \* \&ast; g
s \? \&quest; g
s \r \&#xD; g
s \n \&NewLine; g
s \\ \&bsol; g
